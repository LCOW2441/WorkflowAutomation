// Enter your Slack Incoming Webhook URl
var webhookUrl = 'https://hooks.slack.com/services/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';

var NewTaskMessage = "Enter your message to display when New Task is added";
// Uncomment next message to use pre-defined message
//var NewTaskMessage = "New Task Assigned to " + owner ;

var StatusUpdateMessage = "Enter your message to display when Status is updated";
// Uncomment next message to use pre-defined message
//var StatusUpdateMessage = owner + " set the task " + task + " to " +  status ;

function SendSlackMessage(e) {

  var theRow = e.range.getRow();
  var sheet = SpreadsheetApp.getActiveSheet();
  var range = sheet.getRange(theRow, 1)
  var lastRow = sheet.getLastRow();
  var range = sheet.getRange(lastRow, 1, 1, lastColumn);


// If you want to keep last two columns optional, then write getLastColumn()-2
  var lastColumn = sheet.getLastColumn()-2
// Edit the second parameter of the getRange with the column number of the Status column
  var statusValue = sheet.getRange(theRow, 5, 1, 1).getValue();
// Edit the second parameter of the getRange with the column number of the Owner column
  var owner = sheet.getRange(lastRow, 6, 1, 1).getValue();


  var theCol = e.range.getColumn();
  var rowValues = range.getValues()[0];
  var isRowFilled = rowValues.every(function(cell) {
    return cell !== '';
  });
  var source= e.source;
  var task = source.getActiveSheet().getRange(theRow, 1, 1, 1).getValue();
  var owner = source.getActiveSheet().getRange(lastRow, 6, 1, 1).getValue();
  var status = e.value;

  var headers = {
    'Content-type' : 'application/json'
  }

// For New Task notification
 if (isRowFilled){
  if(statusValue === "Open"&& theCol === lastColumn && owner !== '') {

    var payload = {
      'text' : NewTaskMessage
    }


    var options = {
    headers: headers,
    method : 'POST',
    payload : JSON.stringify(payload)
  }
    UrlFetchApp.fetch(webhookUrl, options);


  } 
// For Status column update notification
  else if(theCol == 5 && statusValue !== "Open"){

    var payload = {
      'text' :  StatusUpdateMessage
    }

    var options = {
    headers: headers,
    method : 'POST',
    payload : JSON.stringify(payload)
  }
    UrlFetchApp.fetch(webhookUrl, options);

  } else{
    return;
  }
}}
